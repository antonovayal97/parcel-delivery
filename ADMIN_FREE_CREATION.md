# Бесплатное создание заявок для администраторов

## Обзор изменений

Добавлена функциональность, позволяющая пользователям с ролью "admin" создавать заявки на доставку бесплатно, без списания кредитов.

## Изменения в коде

### backend/src/routes/parcelRequests.js

**Изменения в функции создания заявок:**

1. **Добавлена проверка роли пользователя:**

   ```javascript
   const userResult = await pool.query(
     "SELECT credits, role FROM users WHERE id = $1",
     [userId]
   );
   ```

2. **Логика списания кредитов:**

   ```javascript
   const isAdmin = userRole === "admin";

   if (!isAdmin && currentCredits < requiredCredits) {
     // Проверка кредитов только для не-админов
   }

   if (!isAdmin) {
     // Списываем кредиты только для обычных пользователей
   } else {
     // Для админов записываем бесплатную транзакцию
   }
   ```

## Поведение системы

### Для администраторов (role = "admin"):

- ✅ Могут создавать заявки без списания кредитов
- ✅ В истории транзакций записываются записи с `amount = 0`
- ✅ Описание транзакции: "Бесплатное создание заявки на [тип] (админ)"

### Для обычных пользователей (role = "user"):

- ✅ Платят 10 кредитов за каждую заявку
- ✅ Проверяется достаточность кредитов
- ✅ Обычные транзакции в истории

## Тестирование

Для тестирования функциональности:

1. Убедитесь, что у вас есть пользователь с `role = "admin"`
2. Запустите скрипт проверки: `node test_admin_creation.js`
3. Создайте заявку через API от имени администратора
4. Проверьте историю транзакций - должна быть запись с `amount = 0`

## API Endpoints

Все существующие эндпоинты работают без изменений:

- `POST /api/parcel-requests` - создание заявки (бесплатно для админов)
- `GET /api/credits/history/:userId` - история транзакций
- `GET /api/credits/balance/:userId` - баланс кредитов

## Обратная совместимость

✅ Все существующие функции работают без изменений
✅ Обычные пользователи продолжают платить кредиты
✅ API интерфейс не изменился
✅ История транзакций сохраняется для всех пользователей
